{% extends 'base.html' %}

{% block title %}ì˜¤ëŠ˜ì˜ ë©”ë‰´ ì¶”ì²œ{% endblock %}

{% block content %}
<style>
    .roulette-wrapper {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 40px 0;
    }
    .random-box {
        width: 100%;
        max-width: 400px;
        height: 200px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
        border: 5px solid #03C75A;
        position: relative;
    }
    .food-text {
        font-size: 36px;
        font-weight: 900;
        color: #333;
    }
    .highlight {
        color: #FF5722;
        transform: scale(1.1);
        transition: transform 0.2s;
    }
    .btn-spin {
        padding: 15px 50px;
        font-size: 20px;
        background-color: #03C75A;
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }
    .btn-spin:disabled { background-color: #ccc; }
    
    #result-modal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6);
        z-index: 9999;
        align-items: center;
        justify-content: center;
    }
    .modal-content {
        background: white;
        padding: 40px;
        border-radius: 15px;
        width: 90%;
        max-width: 400px;
        text-align: center;
    }
    .winner-text { font-size: 28px; color: #FF5722; font-weight: bold; margin: 20px 0; }
    .modal-input {
        padding: 12px; width: 100%; font-size: 16px; 
        border: 2px solid #ddd; border-radius: 8px; margin-bottom: 10px;
        box-sizing: border-box; text-align: center;
    }
    .btn-search { width: 100%; padding: 12px; background: #03C75A; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

    .result-list { width: 100%; max-width: 600px; margin-top: 40px; text-align: left; }
    .place-card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 12px; border: 1px solid #eee; cursor: pointer; transition: 0.2s; }
    .place-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .place-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
    .place-meta { font-size: 14px; color: #666; margin-bottom: 10px; }
    .place-link { display: block; text-align: right; color: #03C75A; font-weight: bold; text-decoration: none; }
</style>

<div class="roulette-wrapper">
    <h2 style="margin-bottom:20px;">ğŸ² ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h2>
    
    <div class="random-box">
        <div class="food-text" id="display-text">ë©”ë‰´ ì¶”ì²œë°›ê¸°</div>
    </div>
    
    <button class="btn-spin" id="spin-btn" onclick="startRandom()">ì¶”ì²œ ì‹œì‘!</button>

    <div class="result-list" id="restaurant-list"></div>
</div>

<div id="result-modal">
    <div class="modal-content">
        <h3>ğŸ‰ ë‹¹ì²¨!</h3>
        <div class="winner-text" id="winner-food"></div>
        <p>í˜„ì¬ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
        <input type="text" class="modal-input" id="location-input" placeholder="ì˜ˆ: ì „ë¶ëŒ€, ê°ì‚¬, ì‹ ì‹œê°€ì§€">
        <button class="btn-search" onclick="searchRestaurants()">ì‹ë‹¹ ê²€ìƒ‰</button>
        <button onclick="$('#result-modal').fadeOut()" style="margin-top:15px; background:none; border:none; color:#999; cursor:pointer;">ë‹«ê¸°</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const foods = [
        "ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ìˆœë‘ë¶€ì°Œê°œ", "ë¶€ëŒ€ì°Œê°œ", "ì²­êµ­ì¥", "ë™íƒœì°Œê°œ", "ë¹„ì§€ì°Œê°œ", "ì§œê¸€ì´", "ìœ¡ê°œì¥", "ê°ˆë¹„íƒ•",
        "ì„¤ë íƒ•", "ê³°íƒ•", "ì‚¼ê³„íƒ•", "ë°˜ê³„íƒ•", "ì¶”ì–´íƒ•", "ê°ìíƒ•", "ë¼ˆí•´ì¥êµ­", "ì„ ì§€í•´ì¥êµ­", "ì½©ë‚˜ë¬¼êµ­ë°¥", "ìˆœëŒ€êµ­ë°¥",
        "ë¼ì§€êµ­ë°¥", "ì†Œë¨¸ë¦¬êµ­ë°¥", "êµ´êµ­ë°¥", "ë¹„ë¹”ë°¥", "ëŒì†¥ë¹„ë¹”ë°¥", "ì œìœ¡ë³¶ìŒ", "ì˜¤ì§•ì–´ë³¶ìŒ", "ë‚™ì§€ë³¶ìŒ", "ì­ˆê¾¸ë¯¸ë³¶ìŒ", "ê¹€ì¹˜ë³¶ìŒë°¥",
        "ì§œì¥ë©´", "ì§¬ë½•", "ê°„ì§œì¥", "ìŸë°˜ì§œì¥", "íƒ•ìˆ˜ìœ¡", "ê¹í’ê¸°", "ìœ ì‚°ìŠ¬", "ë§ˆíŒŒë‘ë¶€", "ë§ˆë¼íƒ•", "ë§ˆë¼ìƒ¹ê¶ˆ",
        "ì–‘ê¼¬ì¹˜", "ëˆê¹ŒìŠ¤", "ì¹˜ì¦ˆëˆê¹ŒìŠ¤", "ìƒì„ ê¹ŒìŠ¤", "ê·œë™", "ê°€ì¸ ë™", "ì‚¬ì¼€ë™", "í…ë™", "ìš°ë™", "ëƒ‰ëª¨ë°€",
        "ë¼ë©˜", "ì†Œë°”", "ì´ˆë°¥", "íšŒë®ë°¥", "ë¬¼íšŒ", "ì•Œë°¥", "ì¹¼êµ­ìˆ˜", "ìˆ˜ì œë¹„", "ì”ì¹˜êµ­ìˆ˜", "ë¹„ë¹”êµ­ìˆ˜",
        "ì«„ë©´", "ë§‰êµ­ìˆ˜", "ë¬¼ëƒ‰ë©´", "ë¹„ë¹”ëƒ‰ë©´", "ì½©êµ­ìˆ˜", "ë–¡ë§Œë‘êµ­", "ë–¡ë³¶ì´", "ë¼ë³¶ì´", "ê¹€ë°¥", "ìˆœëŒ€",
        "í–„ë²„ê±°", "í”¼ì", "íŒŒìŠ¤íƒ€", "ë¦¬ì¡°ë˜", "ìŠ¤í…Œì´í¬", "ìƒŒë“œìœ„ì¹˜", "í† ìŠ¤íŠ¸", "ìƒëŸ¬ë“œ", "í¬ì¼€", "ìŒ€êµ­ìˆ˜",
        "íŒŸíƒ€ì´", "ë‚˜ì‹œê³ ë­", "íƒ€ì½”", "ë¶€ë¦¬ë˜", "ì¡±ë°œ", "ë³´ìŒˆ", "ë‹­ë°œ", "ê³±ì°½", "ë§‰ì°½", "ì°œë‹­", "ë‹­ê°ˆë¹„", "ì¹˜í‚¨"
    ];

    let intervalId = null;

    function startRandom() {
        $('#restaurant-list').empty();
        $('#spin-btn').prop('disabled', true).text('ë‘ê·¼ë‘ê·¼...');
        $('.random-box').css('border-color', '#03C75A');
        $('#display-text').removeClass('highlight');

        intervalId = setInterval(() => {
            const randomFood = foods[Math.floor(Math.random() * foods.length)];
            $('#display-text').text(randomFood);
        }, 50);

        setTimeout(() => {
            clearInterval(intervalId);
            const finalFood = foods[Math.floor(Math.random() * foods.length)];
            $('#display-text').text(finalFood).addClass('highlight');
            $('.random-box').css('border-color', '#FF5722');
            $('#spin-btn').prop('disabled', false).text('ë‹¤ì‹œ ëŒë¦¬ê¸°');
            
            setTimeout(() => {
                $('#winner-food').text(finalFood);
                $('#result-modal').fadeIn().css('display', 'flex');
                $('#location-input').focus();
            }, 600);
        }, 1500);
    }

    function searchRestaurants() {
        const food = $('#winner-food').text();
        const location = $('#location-input').val();
        
        if(!location) { alert('ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
        
        $('.btn-search').text('ê²€ìƒ‰ ì¤‘...');
        
        $.ajax({
            url: '{% url "roulette_search" %}',
            data: { food: food, location: location },
            success: function(res) {
                $('#result-modal').fadeOut();
                $('.btn-search').text('ì‹ë‹¹ ê²€ìƒ‰');
                displayResults(res.places);
            }
        });
    }

    function displayResults(places) {
        const list = $('#restaurant-list');
        list.empty();
        
        if(places.length === 0) {
            list.append('<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>');
            return;
        }

        places.forEach(p => {
            list.append(`
                <div class="place-card" onclick="window.open('${p.link}')">
                    <div class="place-title">${p.title}</div>
                    <div class="place-meta">${p.category} | ${p.address}</div>
                    <a href="${p.link}" target="_blank" class="place-link">ë„¤ì´ë²„ ì§€ë„ ë³´ê¸° &gt;</a>
                </div>
            `);
        });
        
        $('html, body').animate({ scrollTop: list.offset().top - 100 }, 500);
    }

    $('#location-input').on('keypress', function(e) {
        if(e.which == 13) searchRestaurants();
    });
</script>
{% endblock %}